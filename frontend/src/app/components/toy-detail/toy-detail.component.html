<div *ngIf="toy" class="toy-detail-container">
  
  <div class="product-layout">
    <div class="image-section">
      <div class="main-image-card">
        <img [src]="toy.image" [alt]="toy.name" />
      </div>
    </div>

    <div class="info-section">
      <div class="badge-row">
        <span class="category-badge">Premium Igraƒçka</span>
        <span class="stock-status" [class.out]="toy.inStock === 0">
          {{ toy.inStock > 0 ? 'Dostupno: ' + toy.inStock : 'Rasprodato' }}
        </span>
      </div>

      <h1 class="product-title">{{ toy.name }}</h1>
      
      <div class="price-box">
        <span class="currency">‚Ç¨</span>
        <span class="amount">{{ toy.price }}</span>
      </div>

      <div class="description-container">
        <label>Opis proizvoda</label>
        <p>{{ toy.description }}</p>
      </div>

      <div class="action-card">
        <label>Koliƒçina</label>
        <div class="interaction-row">
          <div class="stepper">
            <button (click)="decrease()" [disabled]="quantity <= 0">‚àí</button>
            <span class="val">{{ quantity }}</span>
            <button (click)="increase()" [disabled]="quantity >= toy.inStock">+</button>
          </div>
          
          <button class="main-buy-btn" (click)="addToCart()" [disabled]="quantity === 0 || toy.inStock === 0">
            <span>Dodaj u korpu</span>
            <i class="cart-icon">üõí</i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="reviews-layout">
    <div class="section-header">
      <h2>Iskustva kupaca</h2>
      <div class="divider"></div>
    </div>

    <div class="reviews-grid">
      <div *ngIf="canReview && !checkingReviewPermission" class="write-review-card">
        <h3>Ostavi utisak</h3>
        <div class="star-picker">
          <span *ngFor="let s of [1,2,3,4,5]" (click)="setRating(s)" [class.active]="s <= rating">‚òÖ</span>
        </div>
        <textarea [(ngModel)]="comment" placeholder="Kakva su va≈°a iskustva sa ovom igraƒçkom?"></textarea>
        <button class="submit-btn" (click)="submitReview()" [disabled]="rating === 0 || !comment">
          Objavi recenziju
        </button>
      </div>

      <div class="reviews-feed" [class.full-width]="!canReview">
        <div *ngFor="let rev of toy.reviews" class="modern-review">
          <div class="rev-user">
            <div class="avatar">{{ rev.userFullName?.charAt(0) || 'A' }}</div>
            <div class="user-meta">
              <strong>{{ rev.userFullName || 'Anonimni korisnik' }}</strong>
              <span>{{ rev.createdAt | date:'longDate' }}</span>
            </div>
            <div class="rev-stars">
              <span *ngFor="let s of [].constructor(rev.rating)">‚òÖ</span>
            </div>
          </div>
          <p class="rev-text">{{ rev.comment }}</p>
        </div>

        <div *ngIf="!toy.reviews.length" class="empty-state">
          Jo≈° uvek nema recenzija. Budite prvi koji ƒáe oceniti!
        </div>
      </div>
    </div>
  </div>
</div>